{% extends "base.html" %}

{% block content %}
<div class="container" style="max-width: 900px;">
    <h2>üìã Schritt 2: Kader festlegen</h2>
    <p style="color: #aaa;">W√§hle die Spieler f√ºr den Cup. Gebannte Spieler sind gesperrt.</p>

    <form method="POST">
        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
            
            {% for team in teams %}
            <div class="card" style="border-top: 4px solid #e91e63;">
                <h3 style="margin-top: 0;">{{ team.username }}</h3>
                <div style="max-height: 200px; overflow-y: auto; border: 1px solid #333; padding: 10px; background: #1a1a1a;">
                    
                    {% if team.team_members %}
                        {% for member in team.team_members %}
                            
                            {% set is_banned = member.banned_until and member.banned_until > now %}
                            
                            <label style="display: flex; gap: 10px; padding: 8px; border-bottom: 1px solid #222; align-items: center; 
                                          {% if is_banned %}opacity: 0.5; background: rgba(244, 67, 54, 0.1); cursor: not-allowed;{% else %}cursor: pointer;{% endif %}"
                                   title="Activision ID: {{ member.activision_id }} {% if is_banned %}| ‚õî GRUND: {{ member.ban_reason }} {% endif %}">
                                
                                <input type="checkbox" name="roster_{{ team.id }}" value="{{ member.gamertag }}" 
                                       {% if is_banned %}disabled{% else %}checked{% endif %}>
                                
                                <div style="display: flex; flex-direction: column;">
                                    <span style="font-weight: bold; display: flex; align-items: center; gap: 5px; color: white;">
                                        {{ member.gamertag }}
                                        <span style="font-weight: normal; color: #888; font-size: 0.9em;">({{ member.activision_id }})</span>
                                        {% if is_banned %}
                                            <span style="font-size: 0.7rem; background: #d32f2f; color: white; padding: 2px 4px; border-radius: 4px;">GEBANNT</span>
                                        {% endif %}
                                    </span>
                                    <span style="font-size: 0.8rem; color: #aaa;">{{ member.platform }}</span>
                                </div>
                            </label>
                        {% endfor %}
                    {% else %}
                        <div style="color: var(--danger); font-style: italic;">
                            ‚ö†Ô∏è Dieses Team hat noch keine Spieler im Dashboard.
                        </div>
                    {% endif %}
                    
                </div>
            </div>
            {% endfor %}

        </div>

        <button type="submit" class="btn" style="width: 100%; margin-top: 30px; padding: 15px; font-size: 1.2rem; background: #4caf50;">
            Cup Starten & Matches erstellen ‚úÖ
        </button>
    </form>
</div>
{% endblock %}